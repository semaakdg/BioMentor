<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BioMentor</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: url("close-up-bunch-sprigs.jpg") no-repeat center center fixed;
      background-size: cover;
      font-family: 'Poppins', sans-serif;
    }
    .card {
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(12px);
      border-radius: 16px;
      padding: 20px;
      animation: fadeIn 0.6s ease-in-out;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      transition: transform 0.3s ease;
    }
    .card:hover { transform: translateY(-3px) scale(1.02); }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
    .gradient-btn {
      background: linear-gradient(90deg, #34d399, #059669);
      color: white; font-weight: 600; padding: 12px; border-radius: 10px;
      transition: all 0.3s ease; display: flex; justify-content: center; align-items: center; gap: 6px;
    }
    .gradient-btn:hover { transform: scale(1.07); box-shadow: 0 5px 14px rgba(0, 0, 0, 0.25); }
    textarea, input {
      border-radius: 12px; border: 2px solid transparent; padding: 12px; width: 100%;
      transition: 0.3s; box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    textarea:focus, input:focus {
      border-color: #34d399; outline: none;
      box-shadow: 0 0 10px rgba(52, 211, 153, 0.4);
    }
    #toast {
      position: fixed; bottom: 20px; right: 20px;
      background: #34d399; color: white; padding: 12px 20px;
      border-radius: 10px; font-weight: bold;
      opacity: 0; transform: translateY(20px);
      transition: all 0.5s ease; z-index: 999;
    }
    #toast.show { opacity: 1; transform: translateY(0); }
  </style>
</head>
<body class="flex justify-center items-center min-h-screen p-4">

  <div id="toast">✅ Yanıt Alındı!</div>

  <div id="app" class="w-full max-w-3xl space-y-4">

    <!-- Başlangıç -->
    <div id="startCard" class="card text-center space-y-4">
      <h1 class="text-4xl font-bold text-green-700">🌱 BioMentor AI</h1>
      <p class="text-gray-700 text-lg">Sağlığın için bilimsel, doğal ve kişisel öneriler al!</p>
      <div class="space-y-3">
        <button onclick="showGoals()" class="gradient-btn w-full"><span>🎯</span> Hedefini Seç</button>
        <button onclick="showMentor()" class="gradient-btn w-full bg-gradient-to-r from-blue-400 to-blue-600"><span>💬</span> Mentor’e Sor</button>
        <button onclick="showTest()" class="gradient-btn w-full bg-gradient-to-r from-purple-400 to-purple-600"><span>📝</span> Kendini Test Et</button>
      </div>
    </div>

    <!-- Hedef Seçme -->
    <div id="goalSection" class="hidden space-y-4">
      <h2 class="text-3xl font-semibold text-white text-center drop-shadow-lg">Hedefini Seç</h2>
      <div class="grid grid-cols-2 gap-4">
        <button onclick="selectGoal('Daha Enerjik Olmak')" class="card text-lg font-medium">⚡ Daha Enerjik</button>
        <button onclick="selectGoal('Daha İyi Uyku')" class="card text-lg font-medium">😴 Daha İyi Uyku</button>
        <button onclick="selectGoal('Bağışıklık Güçlendirme')" class="card text-lg font-medium">🛡️ Bağışıklık</button>
        <button onclick="selectGoal('Stres Azaltma')" class="card text-lg font-medium">🧘‍♂️ Stres Azaltma</button>
      </div>
      <button onclick="goBack()" class="gradient-btn w-full bg-gradient-to-r from-gray-400 to-gray-500"><span>⬅️</span> Geri Dön</button>
    </div>

    <!-- Plan -->
    <div id="planSection" class="hidden space-y-4">
      <h2 class="text-3xl font-semibold text-white text-center drop-shadow-lg">📅 Kişisel Öneri Planın</h2>
      <div id="planCards" class="space-y-4"></div>
      <button onclick="showGoals()" class="gradient-btn w-full bg-gradient-to-r from-gray-400 to-gray-500"><span>⬅️</span> Geri Dön</button>
    </div>

    <!-- Mentor -->
    <div id="mentorSection" class="hidden space-y-4">
      <h2 class="text-3xl font-semibold text-white text-center drop-shadow-lg">🧠 Mentor’e Sor</h2>
      <div class="card space-y-3">
        <textarea id="question" placeholder="Sorunuzu yazın..." class="h-24"></textarea>
        <button onclick="askAI()" class="gradient-btn w-full"><span>⚡</span> Yanıt Al</button>
        <div id="answers" class="mt-4 space-y-2"></div>
      </div>
      <button onclick="goBack()" class="gradient-btn w-full bg-gradient-to-r from-gray-400 to-gray-500"><span>⬅️</span> Geri Dön</button>
    </div>

    <!-- Test -->
    <div id="testSection" class="hidden space-y-4">
      <h2 class="text-3xl font-semibold text-white text-center drop-shadow-lg">📝 Kendini Test Et</h2>
      <div id="testQuestions" class="space-y-3"></div>
      <button onclick="showResult()" class="gradient-btn w-full"><span>✅</span> Sonucu Göster</button>
      <button onclick="goBack()" class="gradient-btn w-full bg-gradient-to-r from-gray-400 to-gray-500"><span>⬅️</span> Geri Dön</button>
    </div>

  </div>

  <script>
    const questions = [
      "Gün içinde enerjinizi en çok artıran şey nedir?",
      "Sizi en çok yoran alışkanlığınız veya davranışınız hangisi?",
      "Günlük rutininizde en sağlıklı bulduğunuz 3 alışkanlık nedir?",
      "Şu anda değiştirmek istediğiniz ama ertelediğiniz 1 alışkanlık var mı?",
      "Uykudan önce yaptığınız son 3 şey nedir?",
      "Günlük beslenmenizde en çok tükettiğiniz 3 gıda nedir?",
      "Kendinizi en üretken hissettiğiniz saatler hangileridir?",
      "Gün içinde ne kadar süre hareketsiz kalıyorsunuz?",
      "Hayatınızda size en çok motivasyon veren şey nedir?",
      "Daha sağlıklı bir yaşam için atmanız gereken ilk 3 adım sizce neler?"
    ];

    function showToast(msg) {
      const toast = document.getElementById("toast");
      toast.textContent = msg;
      toast.classList.add("show");
      setTimeout(() => toast.classList.remove("show"), 2500);
    }

    function showGoals() { hideAll(); document.getElementById("goalSection").classList.remove("hidden"); }
    function showMentor() { hideAll(); document.getElementById("mentorSection").classList.remove("hidden"); }
    function showTest() { hideAll(); document.getElementById("testSection").classList.remove("hidden"); loadQuestions(); }
    function goBack() { hideAll(); document.getElementById("startCard").classList.remove("hidden"); }
    function hideAll() { ["startCard","goalSection","planSection","mentorSection","testSection"].forEach(id => document.getElementById(id).classList.add("hidden")); }

    function loadQuestions() {
      const container = document.getElementById("testQuestions");
      container.innerHTML = "";
      questions.forEach((q, i) => {
        container.innerHTML += `
          <div class="card">
            <label class="font-medium block mb-2">${i + 1}. ${q}</label>
            <textarea class="resize-none h-20"></textarea>
          </div>`;
      });
    }

    async function selectGoal(goal) {
      hideAll();
      document.getElementById("planSection").classList.remove("hidden");
      const container = document.getElementById("planCards");
      container.innerHTML = "<p class='text-white text-lg'>⏳ Plan hazırlanıyor...</p>";

      const res = await fetch("http://127.0.0.1:8000/plan", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ goal }),
      });

      const data = await res.json();
      container.innerHTML = "";

      const card = document.createElement("div");
      card.className = "card";
      renderAnswer(card, data.answer);
      container.appendChild(card);
      showToast("🎉 Plan Hazırlandı!");
    }

    async function askAI() {
      const q = document.getElementById("question").value.trim();
      if (!q) return;

      const answersDiv = document.getElementById("answers");
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `<p class="font-semibold text-red-700">❓ Soru: ${q}</p><p id="loadingText" class="text-gray-500 italic">⏳ Yanıt bekleniyor...</p>`;
      answersDiv.prepend(card);
      document.getElementById("question").value = "";

      const res = await fetch("http://127.0.0.1:8000/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ question: q }),
      });

      const data = await res.json();
      card.querySelector("#loadingText")?.remove();

      if (!data.answer) {
        card.innerHTML += `<p class="text-red-500 mt-2">⚠️ Yanıt alınamadı.</p>`;
        return;
      }

      renderAnswer(card, data.answer);
      showToast("✅ Yanıt Alındı!");
    }

    function renderAnswer(container, text) {
      const cleanText = text.replace(/\*/g, "");
      const [shortPart, detailsAndWarning] = cleanText.split("Detaylar:");
      const [detailPart, warningPart] = detailsAndWarning ? detailsAndWarning.split("Uyarı:") : ["", ""];

      container.innerHTML += `<h3 class="font-bold text-green-700 mt-2">🌱 Kısa Öneriler</h3>`;
      shortPart.split("\n").forEach(line => {
        if (line.trim().startsWith("-")) {
          container.innerHTML += `<p>✅ ${line.replace("-", "").trim()}</p>`;
        }
      });

      if (detailPart) {
        container.innerHTML += `<h3 class="font-bold text-blue-700 mt-2">📖 Detaylı Açıklamalar</h3>`;
        detailPart.split("\n").forEach(line => {
          if (line.trim().startsWith("-")) {
            container.innerHTML += `<p>💡 ${line.replace("-", "").trim()}</p>`;
          }
        });
      }

      if (warningPart) {
        container.innerHTML += `<p class="text-red-600 font-semibold mt-2">⚠️ ${warningPart.replace("-", "").trim()}</p>`;
      }
    }
  </script>
</body>
</html>
